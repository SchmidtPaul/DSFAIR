---
title: "Split-plot design"
output: 
  html_document:
    includes:
      in_header: header.html
      after_body: footer.html		
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# formatting tables for html output
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
options(knitr.kable.NA = '')
pacman::p_load(kableExtra, formattable ,htmltools)
pacman::p_load(purrr)
```

```{r, message=FALSE, warning=FALSE}
# packages
pacman::p_load(readr, tidyverse, forcats, # data import and handling
               lme4, lmerTest,            # linear mixed model 
               emmeans, multcomp,         # mean comparisons
               ggplot2, desplot)          # plots
```

# Data

This example is taken from Chapter *"4.1 The sorghum experiment"* of the course material ["Mixed models for metric data (3402-451)"](https://www.uni-hohenheim.de/en/module-catalogue/lehrveranstaltung/mixed-models-for-metric-data-3402-451){target="_blank"} by [Prof. Dr. Hans-Peter Piepho](https://www.uni-hohenheim.de/organisation?tx_base_lsfcontentadmin%5BlsfPerson%5D=6257){target="_blank"}. It considers data published in [Piepho (1997)](https://acsess.onlinelibrary.wiley.com/doi/abs/10.2134/agronj1997.00021962008900050002x){target="_blank"} from a greenhouse experiment with sorghum, three intensities of double use of grain and leaves were tested: (1) control (grain only) `Ctrl`; (2) removal of all leaves except top leaf `Top1`; (3) removal of all leaves except top six leaves `Top6`.

## Import

```{r, message=FALSE, warning=FALSE}
# data (import via URL)
dataURL <- "https://raw.githubusercontent.com/SchmidtPaul/DSFAIR/master/data/Piepho1997.csv"
dat <- read_csv(dataURL)

dat
```

## Formatting

Before anything, the columns `treat`, `block` and `plant` should be encoded as factors, since R by default encoded them as character. Furthermore, I would like to arrange the factors in a specific order that is different from the default alphabetical order:

```{r}
dat <- dat %>% 
  mutate_at(vars(treat, block, plant), as.factor) %>% 
  mutate(treat = fct_relevel(treat, c("Ctrl", "Top6", "Top1")))
```

